version: '3.8'

services:
  # Backend API
  backend:
    build:
      context: ./backend
      dockerfile: Dockerfile
    container_name: building-twin-api
    ports:
      - "8000:8000"
    environment:
      - DEBUG=true
      - HOST=0.0.0.0
      - PORT=8000
    volumes:
      - ./backend:/app
    restart: unless-stopped
    # healthcheck:
    #   test: ["CMD", "curl", "-f", "http://localhost:8000/health"]
    #   interval: 30s
    #   timeout: 10s
    #   retries: 3

  # Future services (uncomment when needed)

  # InfluxDB - Time-series database
  # influxdb:
  #   image: influxdb:2.7
  #   container_name: building-twin-influxdb
  #   ports:
  #     - "8086:8086"
  #   volumes:
  #     - influxdb-data:/var/lib/influxdb2
  #   environment:
  #     - DOCKER_INFLUXDB_INIT_MODE=setup
  #     - DOCKER_INFLUXDB_INIT_USERNAME=admin
  #     - DOCKER_INFLUXDB_INIT_PASSWORD=adminpassword
  #     - DOCKER_INFLUXDB_INIT_ORG=building-twin
  #     - DOCKER_INFLUXDB_INIT_BUCKET=sensor-data
  #   restart: unless-stopped

  # MQTT Broker
  # mosquitto:
  #   image: eclipse-mosquitto:2
  #   container_name: building-twin-mqtt
  #   ports:
  #     - "1883:1883"
  #     - "9001:9001"
  #   volumes:
  #     - ./config/mosquitto/mosquitto.conf:/mosquitto/config/mosquitto.conf
  #     - mosquitto-data:/mosquitto/data
  #     - mosquitto-log:/mosquitto/log
  #   restart: unless-stopped

  # Grafana - Dashboards
  # grafana:
  #   image: grafana/grafana:latest
  #   container_name: building-twin-grafana
  #   ports:
  #     - "3001:3000"
  #   volumes:
  #     - grafana-data:/var/lib/grafana
  #   environment:
  #     - GF_SECURITY_ADMIN_PASSWORD=admin
  #   restart: unless-stopped
  #   depends_on:
  #     - influxdb

# volumes:
#   influxdb-data:
#   mosquitto-data:
#   mosquitto-log:
#   grafana-data:
